<!DOCTYPE html>
<html lang="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Phylogeny.IO">
    <meta name="keywords" content="phylogeny, phylogenic, tree, evolution, visualisation, phylogeny.io">

    <title>Upload Your Own | QuickTree</title>

    <link rel="apple-touch-icon" sizes="180x180" href="../favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../favicon/favicon-16x16.png">
    <link rel="manifest" href="../favicon/site.webmanifest">
    <link rel="mask-icon" href="../favicon/safari-pinned-tab.svg" color="#679436">
    <meta name="msapplication-TileColor" content="#9bc04f">
    <meta name="theme-color" content="#ffffff">
    <link rel="shortcut icon" href="../favicon.ico">


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>



    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://kit.fontawesome.com/9533923917.js" crossorigin="anonymous"></script>

    <!-- Bootstrap 3.3.2 -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css" integrity="sha512-+L4yy6FRcDGbXJ9mPG8MT/3UCDzwR9gPeyFNMCtInsol++5m3bk2bXWKdZjvybmohrAsn3Ua5x8gfLnbE1YkOg==" crossorigin="anonymous" />
    <!--    <link href="plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" media="screen">-->
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.0/css/ionicons.min.css" integrity="sha512-JApjWRnfonFeGBY7t4yq8SWr1A6xVYEJgO/UMIYONxaR3C9GETKUg0LharbJncEzJF5Nmiv+Pr5QNulr81LjGQ==" crossorigin="anonymous" />
    <!--    <link href="plugins/ionicons/css/ionicons.min.css" rel="stylesheet" type="text/css" />-->
    <!-- Theme style -->
    <!-- <link href="css/AdminLTE.min.css" rel="stylesheet" type="text/css" /> -->
    <link href="../css/AdminLTE.css" rel="stylesheet" type="text/css" />
    <!-- Plugins -->
    <link href="../plugins/jQueryUI/themes/smoothness/jquery-ui.min.css" rel="stylesheet" type="text/css" >
    <!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js" integrity="sha512-BHDCWLtdp0XpAFccP2NifCbJfYoYhsRSZOUM3KnAxy2b/Ay3Bn91frud+3A95brA4wDWV3yEOZrJqgV8aZRXUQ==" crossorigin="anonymous"></script>-->
    <!--    <link href="plugins/jQueryUI/themes/smoothness/jquery-ui.theme.min.css" rel="stylesheet" type="text/css" >-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.theme.min.css" integrity="sha512-8C+S6eahxjgYqebo+XrQTH6GyrpUeVchFmfDFUB0QSBShsBxdw19EIEdtTIWa8Z8UbjpQMzpe/xQNURMqtnRvQ==" crossorigin="anonymous" />
    <link href="../plugins/evol.colorpicker/css/evol.colorpicker.css" rel="stylesheet" type="text/css">
    <!--    <link href="plugins/bootstrap-slider/bootstrap-slider.css" rel="stylesheet" media="screen">-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/4.4.2/css/bootstrap-slider.css" integrity="sha512-TQ5LKAAZ6bbt6pLQ1k5Jzw7Xl3pVR/WXGyQOXoYwt7UylZvdStBFt44taYanfBwUElN52Is2UbqLMBFjZkn7qg==" crossorigin="anonymous" />
    <!--    <link href="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css" rel="stylesheet" type="text/css" />-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-wysiwyg/0.3.3/bootstrap3-wysihtml5.min.css" integrity="sha512-Bhi4560umtRBUEJCTIJoNDS6ssVIls7oiYyT3PbhxZV+9uBbLVO/mWo56hrBNNbIfMXKvtIPJi/Jg+vpBpA7sg==" crossorigin="anonymous" />
    <link href="../plugins/d3/d3.tip.css" rel="stylesheet">
    <!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.6.3/d3-tip.min.js" integrity="sha512-hF1zbOtVA6MrNXCycEUAXJkm3XkvQI49d2fBIrXaVYJRkhiCfnbOrEmEffaelo7DVaRkHQzGEfb69fzM09UXPQ==" crossorigin="anonymous"></script>-->
    <!-- AdminLTE Skins. Choose a skin from the css/skins folder instead of downloading all of them to reduce the load. -->
    <link href="../css/skins/skin-blue.css" rel="stylesheet" type="text/css" />
    <link href="../css/skins/skin-black.css" rel="stylesheet" type="text/css" />
    <link href="../css/patterns.css" rel="stylesheet" type="text/css" />

    <link href="../css/design.css" rel="stylesheet" type="text/css" />


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <link href="../css/custom.css" rel="stylesheet" type="text/css" />
    <link href="../css/upload.css" rel="stylesheet" type="text/css" />
</head>
<body class="skin-black fixed">

<a href="../index.html" class="">
    <button type="button" class="btn btn-primary"><i class="fas fa-arrow-left"></i> Back </button>
</a>
<div class="objs row">
    <div class="tree col-md col-lg">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 291.294 198.933">
            <path id="Icon_metro-tree" data-name="Icon metro-tree" d="M192.179,217.471H189.07V154.358c0-18.739-9.761-33.984-21.758-33.984H114.47V81.534h3.108c5.129,0,9.325-6.554,9.325-14.565V18.421c0-8.011-4.2-14.565-9.325-14.565H86.5c-5.129,0-9.325,6.554-9.325,14.565V66.97c0,8.011,4.2,14.565,9.325,14.565H89.6v38.839H36.762c-12,0-21.758,15.246-21.758,33.984v63.114H11.9c-5.129,0-9.325,6.554-9.325,14.565v48.549c0,8.011,4.2,14.565,9.325,14.565H42.979c5.129,0,9.325-6.554,9.325-14.565V232.036c0-8.011-4.2-14.565-9.325-14.565H39.871V159.213H89.6v58.259H86.5c-5.129,0-9.325,6.554-9.325,14.565v48.549c0,8.011,4.2,14.565,9.325,14.565h31.083c5.129,0,9.325-6.554,9.325-14.565V232.036c0-8.011-4.2-14.565-9.325-14.565H114.47V159.213H164.2v58.259H161.1c-5.129,0-9.325,6.554-9.325,14.565v48.549c0,8.011,4.2,14.565,9.325,14.565h31.083c5.129,0,9.325-6.554,9.325-14.565V232.036c0-8.011-4.2-14.565-9.325-14.565ZM39.871,275.73H15V236.891H39.871Zm74.6,0H89.6V236.891H114.47ZM89.6,62.115V23.276H114.47V62.115H89.6ZM189.07,275.73H164.2V236.891H189.07Z" transform="translate(-3.856 201.504) rotate(-90)" fill="#679436"/>
        </svg>
    </div>
    <div class="text col-md col-lg">
        <h2>Upload Your Own</h2>
<!--            <div id="drop-area">-->
<!--                <form class="my-form">-->
<!--                    <div>-->
<!--                        <input type="file" id="files" multiple>-->
<!--                        <div><small>Drag & drop<br/>DATA<br/>&<br/>TREE<br/>&<br/>COMPARISONS<br/>files here, <br/>or</small><br/></div>-->
<!--                        <label class="button" for="files">Manually select files</label>-->
<!--                    </div>-->
<!--                </form>-->
<!--            </div>-->
        <div id="drop-area">
            <p>Please select the following files:</p>
            <hr/>
            <ol>
                <li>A file containing the nexus or newick format of your tree.</li>
                <li>A file containing your species data in JSON format.</li>
                <li>A file containing your species DNA comparisons in JSON format.</li>
            </ol>
            <h4><strong>NOTE:</strong> Name files with 'tree', 'data', and 'comp'</h4>
            <hr/>
            <div>
                <input type="file" id="files" multiple>
            </div>
        </div>


        <p STYLE="color: #000000">For instructions, <a href="upload_instructions.html">click here</a>.</p>



        <div id="jsonSaveDiv" class="hidden text-center">
            <button id="jsonSaveBtn" class="btn btn-sm btn-primary"><i class="fa fa-floppy-o"></i>Save JSON</button>
        </div>

    </div>
</div>

<script>
    let dataDropArea = document.getElementById('drop-area');
    let fileCount = 0;
    let json;

    function handleFileSelect(evt) {
        let files = evt.target.files;
        storage = window.sessionStorage
        if (files.length === 3) {
            for (let i = 0, f; f = files[i]; i++) {
                let reader = new FileReader();
                let fileName = f.name;
                reader.onload = ( theFile => {
                    return function (e) {
                        console.log('e readAsText = ', e);
                        console.log('e readAsText target = ', e.target);
                        try {
                            console.log(fileName)
                            if (fileName.toLowerCase().includes("tree")) {
                                console.log('TREE')
                                console.log(e.target.result)
                                storage.setItem('tree', e.target.result)
                                storage.setItem('treeName', fileName.split('.')[0])
                            } else if (fileName.toLowerCase().includes("comp")) {
                                console.log('comparison')
                                json = JSON.parse(e.target.result);
                                console.log(json)
                                // storage.setItem('comparisons', e.target.result)
                                storage.setItem('comparisons', JSON.stringify(json))
                            } else {
                                console.log('data')
                                json = JSON.parse(e.target.result);
                                console.log(json)
                                // storage.setItem('data', e.target.result)
                                storage.setItem('data', JSON.stringify(json))
                            }
                        } catch (ex) {
                            alert('ex when trying to parse json = ' + ex);
                        }
                    }
                })(f);
                reader.readAsText(f);
            }
            window.location.replace("phylotree.html");
        } else {
            alert("Please provide 3 files");
        }
    }
    document.getElementById('files').addEventListener('change', handleFileSelect, false);

</script>

<!-- jQuery 2.1.3 -->
<script src="../plugins/jQuery/jQuery-2.1.3.min.js"></script>
<!-- Bootstrap 3.3.2 JS -->
<script src="../plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<!-- Underscore.js -->
<script src="../plugins/underscore/underscore-min.js"></script>
<!-- jQuery UI -->
<script src="../plugins/jQueryUI/jquery-ui.min.js"></script>
<!-- jQuery Validate -->
<script src="../plugins/jquery-validate/jquery.validate.min.js"></script>
<!-- jQuery.BlockUI -->
<script src='../plugins/jQuery.blockUI/jquery.blockUI.js'></script>
<!-- D3 Library -->
<script src="../plugins/d3/d3.min.js"></script>
<script src="../plugins/d3/d3.tip.js"></script>
<!-- JSON Prune -->
<script src="../js/JSON.prune.js" type="text/javascript"></script>
<!-- Bootstrap Slider -->
<script src="../plugins/bootstrap-slider/bootstrap-slider.min.js"></script>
<!-- Color picker -->
<script src="../plugins/evol.colorpicker/js/evol.colorpicker.min.js" type="text/javascript"></script>
<!-- Chroma.js -->
<script src="../plugins/chroma.js/chroma.min.js" type="text/javascript"></script>
<!-- Slimscroll -->
<script src="../plugins/slimScroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<!-- Clipboard.js -->
<script src="../plugins/clipboard.js/clipboard.min.js" type="text/javascript"></script>
<!-- FastClick -->
<script src='../plugins/fastclick/fastclick.min.js'></script>
<!-- Bootstrap WYSIHTML5 -->
<script src="../plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js" type="text/javascript"></script>
<!-- AdminLTE App -->
<script src="../js/app.js" type="text/javascript"></script>
<!-- Require JS -->
<script data-main="../js/main" src="../plugins/require/require.js"></script>

</body>
</html>
